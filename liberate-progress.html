<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIBERATE Progress Tracker | DISCERN Protocol</title>

    <!-- Desktop Enhancement Framework -->
    <link rel="stylesheet" href="desktop-enhancements.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="theme-system.js"></script>
    <style>
        :root {
            /* Light Theme Variables */
            --bg-primary: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            --bg-secondary: rgba(255, 255, 255, 0.98);
            --bg-glass: rgba(255, 255, 255, 0.25);
            --bg-glass-hover: rgba(255, 255, 255, 0.35);
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --text-tertiary: #6b7280;
            --border-color: rgba(249, 115, 22, 0.2);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --shadow-hover: rgba(249, 115, 22, 0.3);
            --backdrop-blur: blur(20px);
        }

        [data-theme="dark"] {
            /* Dark Theme Variables - WCAG AA+ Compliant */
            --bg-primary: linear-gradient(135deg, #7c2d12 0%, #991b1b 100%);
            --bg-secondary: rgba(15, 23, 42, 0.98);
            --bg-glass: rgba(30, 41, 59, 0.85);
            --bg-glass-hover: rgba(30, 41, 59, 0.95);
            --card-bg: rgba(30, 41, 59, 0.95);
            --text-primary: #ffffff;
            --text-secondary: #f1f5f9;
            --text-tertiary: #e2e8f0;
            --text-on-glass: #ffffff;
            --text-hover: #fed7aa;
            --border-color: rgba(203, 213, 225, 0.3);
            --shadow-color: rgba(0, 0, 0, 0.4);
            --shadow-hover: rgba(251, 146, 60, 0.4);
            --backdrop-blur: blur(20px);
            --accent-primary: #fb923c;
            --accent-secondary: #f97316;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--bg-glass);
            backdrop-filter: var(--backdrop-blur);
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 15px var(--shadow-color);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1100;
            transition: all 0.3s ease;
            color: var(--text-on-glass);
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow-hover);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: var(--bg-glass);
            backdrop-filter: var(--backdrop-blur);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow-color);
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-glass);
            backdrop-filter: var(--backdrop-blur);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px var(--shadow-color);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--shadow-hover);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section {
            background: var(--bg-glass);
            backdrop-filter: var(--backdrop-blur);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow-color);
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .phase-tracker {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .phase {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .phase.active {
            border-color: #f97316;
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
        }

        .phase.completed {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(22, 163, 74, 0.1) 100%);
            border-color: #22c55e;
        }

        .phase-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .phase-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .phase-status {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: var(--bg-secondary);
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f97316 0%, #dc2626 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 600;
        }

        .journal-entry {
            margin-bottom: 20px;
        }

        .journal-entry textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 1rem;
            resize: vertical;
            font-family: inherit;
        }

        .journal-entry textarea:focus {
            outline: none;
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }

        .saved-entries {
            margin-top: 20px;
        }

        .entry-card {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #f97316;
        }

        .entry-date {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .entry-text {
            color: var(--text-primary);
            line-height: 1.6;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
        }

        .btn-secondary {
            background: var(--bg-glass);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-glass-hover);
        }

        .milestones-list {
            list-style: none;
        }

        .milestone-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.2s ease;
        }

        .milestone-item:hover {
            transform: translateX(5px);
        }

        .milestone-item.completed {
            opacity: 0.7;
            text-decoration: line-through;
        }

        .milestone-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .safety-check {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #fca5a5;
        }

        [data-theme="dark"] .safety-check {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.2) 0%, rgba(185, 28, 28, 0.2) 100%);
            border-color: rgba(248, 113, 113, 0.3);
        }

        .safety-check h3 {
            color: #dc2626;
            margin-bottom: 10px;
        }

        [data-theme="dark"] .safety-check h3 {
            color: #fca5a5;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 350px;
            margin: 20px auto;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-container canvas {
            max-width: 100% !important;
            max-height: 100% !important;
            width: 100% !important;
            height: auto !important;
            display: block !important;
            margin: 0 auto !important;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .phase-tracker {
                grid-template-columns: 1fr;
            }
        }

        /* Floating Chat Button */
        .floating-chat-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            color: white;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(249, 115, 22, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            animation: pulse-dove 2s infinite;
        }

        @keyframes pulse-dove {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .floating-chat-button:hover {
            transform: scale(1.15);
            box-shadow: 0 12px 32px rgba(249, 115, 22, 0.6);
        }

        .floating-chat-button.hidden {
            display: none;
        }

        .chat-widget-panel {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 400px;
            height: 600px;
            background: var(--bg-secondary);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            transform: translateY(calc(100% + 60px));
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 999;
            overflow: hidden;
        }

        .chat-widget-panel.active {
            transform: translateY(0);
            opacity: 1;
        }

        .chat-widget-header {
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px 20px 0 0;
        }

        .chat-header-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .chat-icon {
            font-size: 1.5rem;
        }

        .chat-header-actions {
            display: flex;
            gap: 0.5rem;
        }

        .chat-action-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 1.2rem;
        }

        .chat-action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-widget-body {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0;
            background: var(--bg-secondary);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: transparent;
            min-height: 300px;
            max-height: 400px;
        }

        .chat-message {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            align-items: flex-start;
        }

        .chat-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .chat-avatar.assistant {
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
        }

        .chat-avatar.user {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        .chat-bubble {
            background: var(--bg-glass);
            backdrop-filter: var(--backdrop-blur);
            padding: 0.875rem 1.125rem;
            border-radius: 16px;
            max-width: 75%;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .chat-bubble.assistant {
            border-top-left-radius: 4px;
        }

        .chat-bubble.user {
            border-top-right-radius: 4px;
            margin-left: auto;
        }

        .chat-input-area {
            padding: 0 1rem 1rem 1rem;
            background: var(--bg-secondary);
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-glass);
            backdrop-filter: var(--backdrop-blur);
            color: var(--text-primary);
            font-size: 0.95rem;
            resize: none;
            min-height: 80px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }

        .chat-input::placeholder {
            color: var(--text-tertiary);
        }

        .send-button {
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            transition: all 0.2s ease;
            align-self: flex-end;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(249, 115, 22, 0.4);
        }

        .send-button:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .chat-widget-panel {
                width: calc(100vw - 40px);
                height: calc(100vh - 40px);
                bottom: 20px;
                right: 20px;
            }

            .floating-chat-button {
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Toggle Button -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <span class="theme-icon" id="theme-icon">üåô</span>
        <span id="theme-text">Dark Mode</span>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="icon">üïäÔ∏è</div>
            <h1>LIBERATE Progress Tracker</h1>
            <p>Track your liberation journey: From recognition to flourishing</p>
        </div>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Days of Freedom</h3>
                <div class="value" id="daysSince">0</div>
            </div>
            <div class="stat-card">
                <h3>Current Phase</h3>
                <div class="value" style="font-size: 1.5rem;" id="currentPhase">Recognition</div>
            </div>
            <div class="stat-card">
                <h3>Milestones Completed</h3>
                <div class="value" id="milestonesCompleted">0/24</div>
            </div>
            <div class="stat-card">
                <h3>Journal Entries</h3>
                <div class="value" id="journalCount">0</div>
            </div>
        </div>

        <!-- Overall Progress -->
        <div class="section">
            <h2 class="section-title">üìà Overall Liberation Progress</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="overallProgress" style="width: 0%">0%</div>
            </div>
        </div>

        <!-- Phase Tracker -->
        <div class="section">
            <h2 class="section-title">üó∫Ô∏è Journey Phases</h2>
            <div class="phase-tracker">
                <div class="phase" id="phase1" onclick="selectPhase(1)">
                    <div class="phase-icon">üëÅÔ∏è</div>
                    <div class="phase-name">Recognition</div>
                    <div class="phase-status">Seeing clearly</div>
                </div>
                <div class="phase" id="phase2" onclick="selectPhase(2)">
                    <div class="phase-icon">üìã</div>
                    <div class="phase-name">Planning</div>
                    <div class="phase-status">Preparing safely</div>
                </div>
                <div class="phase" id="phase3" onclick="selectPhase(3)">
                    <div class="phase-icon">üöÄ</div>
                    <div class="phase-name">Action</div>
                    <div class="phase-status">Taking the leap</div>
                </div>
                <div class="phase" id="phase4" onclick="selectPhase(4)">
                    <div class="phase-icon">üíö</div>
                    <div class="phase-name">Healing</div>
                    <div class="phase-status">Processing & growing</div>
                </div>
                <div class="phase" id="phase5" onclick="selectPhase(5)">
                    <div class="phase-icon">ü¶Ö</div>
                    <div class="phase-name">Independence</div>
                    <div class="phase-status">Building your life</div>
                </div>
                <div class="phase" id="phase6" onclick="selectPhase(6)">
                    <div class="phase-icon">üåü</div>
                    <div class="phase-name">Flourishing</div>
                    <div class="phase-status">Thriving in freedom</div>
                </div>
            </div>
        </div>

        <!-- Safety Check -->
        <div class="section">
            <div class="safety-check">
                <h3>üõ°Ô∏è Safety Check-In</h3>
                <p>Are you safe right now? If you're in danger, please reach out:</p>
                <ul style="margin: 10px 0 10px 20px; line-height: 1.8;">
                    <li><strong>National Domestic Violence Hotline:</strong> 1-800-799-7233</li>
                    <li><strong>Crisis Text Line:</strong> Text HOME to 741741</li>
                </ul>
                <button class="btn btn-primary" onclick="window.open('https://www.thehotline.org/', '_blank')">
                    Get Help Now
                </button>
            </div>
        </div>

        <!-- Milestones -->
        <div class="section">
            <h2 class="section-title">‚úÖ Liberation Milestones</h2>
            <ul class="milestones-list" id="milestonesList">
                <!-- Populated by JavaScript -->
            </ul>
        </div>

        <!-- Healing Progress Chart -->
        <div class="section">
            <h2 class="section-title">üìä Healing Metrics</h2>
            <div class="chart-container">
                <canvas id="healingChart"></canvas>
            </div>
        </div>

        <!-- Journal -->
        <div class="section">
            <h2 class="section-title">üìî Healing Journal</h2>
            <div class="journal-entry">
                <textarea id="journalInput" placeholder="Reflect on your journey today... How are you feeling? What progress have you made? What challenges are you facing?"></textarea>
                <button class="btn btn-primary" onclick="saveJournalEntry()">üíæ Save Entry</button>
            </div>
            <div class="saved-entries" id="savedEntries"></div>
        </div>

        <!-- Actions -->
        <div class="section">
            <h2 class="section-title">üéØ Actions</h2>
            <button class="btn btn-primary" onclick="exportProgress()">üì• Export Progress Report</button>
            <button class="btn btn-secondary" onclick="window.open('https://chatgpt.com/g/g-685f7ec1cae4819183b514fdeff27b43-discern-bot-relationship-navigation-coach', '_blank')">
                ü§ñ Talk to DISCERN Bot
            </button>
            <button class="btn btn-secondary" onclick="window.location.href='liberate-contract.html'">
                üìù View Contract
            </button>
            <button class="btn btn-secondary" onclick="window.location.href='liberate_visual_framework.html'">
                üé® View Framework
            </button>
        </div>
    </div>

    <script>
        // Data structure for milestones
        const milestones = [
            // Phase 1: Recognition
            { id: 1, phase: 1, text: 'Acknowledged the need for change', completed: false },
            { id: 2, phase: 1, text: 'Identified patterns of harm or dysfunction', completed: false },
            { id: 3, phase: 1, text: 'Reached out for support or information', completed: false },
            { id: 4, phase: 1, text: 'Started exploring liberation as an option', completed: false },

            // Phase 2: Planning
            { id: 5, phase: 2, text: 'Created a safety plan', completed: false },
            { id: 6, phase: 2, text: 'Identified safe contacts and places', completed: false },
            { id: 7, phase: 2, text: 'Gathered important documents and resources', completed: false },
            { id: 8, phase: 2, text: 'Set financial independence goals', completed: false },

            // Phase 3: Action
            { id: 9, phase: 3, text: 'Took the step to physically separate', completed: false },
            { id: 10, phase: 3, text: 'Established no-contact or limited contact boundaries', completed: false },
            { id: 11, phase: 3, text: 'Secured safe housing', completed: false },
            { id: 12, phase: 3, text: 'Notified support network', completed: false },

            // Phase 4: Healing
            { id: 13, phase: 4, text: 'Started therapy or counseling', completed: false },
            { id: 14, phase: 4, text: 'Joined a support group', completed: false },
            { id: 15, phase: 4, text: 'Processed grief and loss', completed: false },
            { id: 16, phase: 4, text: 'Practiced self-compassion and self-care', completed: false },

            // Phase 5: Independence
            { id: 17, phase: 5, text: 'Achieved financial independence', completed: false },
            { id: 18, phase: 5, text: 'Built a new social support network', completed: false },
            { id: 19, phase: 5, text: 'Rediscovered personal identity and interests', completed: false },
            { id: 20, phase: 5, text: 'Established healthy daily routines', completed: false },

            // Phase 6: Flourishing
            { id: 21, phase: 6, text: 'Created a vision for my future', completed: false },
            { id: 22, phase: 6, text: 'Pursued new goals and dreams', completed: false },
            { id: 23, phase: 6, text: 'Helped others on their healing journey', completed: false },
            { id: 24, phase: 6, text: 'Celebrated my growth and resilience', completed: false }
        ];

        // Initialize from localStorage
        let progressData = JSON.parse(localStorage.getItem('liberateProgress')) || {
            startDate: new Date().toISOString(),
            currentPhase: 1,
            completedMilestones: [],
            journalEntries: [],
            healingMetrics: {
                emotional: 50,
                financial: 50,
                social: 50,
                physical: 50
            }
        };

        // Save progress
        function saveProgress() {
            localStorage.setItem('liberateProgress', JSON.stringify(progressData));
            updateUI();
        }

        // Load contract data if exists
        const contractData = JSON.parse(localStorage.getItem('liberateContract'));
        if (contractData && contractData.startDate) {
            progressData.startDate = new Date(contractData.startDate).toISOString();
        }

        // Calculate days since start
        function calculateDaysSince() {
            const start = new Date(progressData.startDate);
            const now = new Date();
            const diff = Math.floor((now - start) / (1000 * 60 * 60 * 24));
            return Math.max(0, diff);
        }

        // Update UI
        function updateUI() {
            // Update stats
            document.getElementById('daysSince').textContent = calculateDaysSince();

            const phaseNames = ['Recognition', 'Planning', 'Action', 'Healing', 'Independence', 'Flourishing'];
            document.getElementById('currentPhase').textContent = phaseNames[progressData.currentPhase - 1];

            const completed = progressData.completedMilestones.length;
            document.getElementById('milestonesCompleted').textContent = `${completed}/24`;

            document.getElementById('journalCount').textContent = progressData.journalEntries.length;

            // Update overall progress
            const progressPercent = Math.round((completed / 24) * 100);
            const progressFill = document.getElementById('overallProgress');
            progressFill.style.width = progressPercent + '%';
            progressFill.textContent = progressPercent + '%';

            // Update phases
            for (let i = 1; i <= 6; i++) {
                const phaseEl = document.getElementById(`phase${i}`);
                phaseEl.classList.remove('active', 'completed');

                if (i === progressData.currentPhase) {
                    phaseEl.classList.add('active');
                } else if (i < progressData.currentPhase) {
                    phaseEl.classList.add('completed');
                }
            }

            // Update milestones list
            renderMilestones();

            // Update journal entries
            renderJournalEntries();

            // Update chart
            updateChart();
        }

        // Render milestones
        function renderMilestones() {
            const list = document.getElementById('milestonesList');
            list.innerHTML = '';

            milestones.forEach(milestone => {
                const isCompleted = progressData.completedMilestones.includes(milestone.id);
                const li = document.createElement('li');
                li.className = 'milestone-item' + (isCompleted ? ' completed' : '');

                li.innerHTML = `
                    <input type="checkbox"
                           class="milestone-checkbox"
                           ${isCompleted ? 'checked' : ''}
                           onchange="toggleMilestone(${milestone.id})">
                    <span>${milestone.text}</span>
                `;

                list.appendChild(li);
            });
        }

        // Toggle milestone
        function toggleMilestone(id) {
            const index = progressData.completedMilestones.indexOf(id);
            if (index > -1) {
                progressData.completedMilestones.splice(index, 1);
            } else {
                progressData.completedMilestones.push(id);
            }
            saveProgress();
        }

        // Select phase
        function selectPhase(phase) {
            progressData.currentPhase = phase;
            saveProgress();
        }

        // Save journal entry
        function saveJournalEntry() {
            const input = document.getElementById('journalInput');
            const text = input.value.trim();

            if (!text) {
                alert('Please write something before saving.');
                return;
            }

            progressData.journalEntries.unshift({
                date: new Date().toISOString(),
                text: text
            });

            input.value = '';
            saveProgress();
        }

        // Render journal entries
        function renderJournalEntries() {
            const container = document.getElementById('savedEntries');
            container.innerHTML = '';

            if (progressData.journalEntries.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No journal entries yet. Start writing to track your healing journey!</p>';
                return;
            }

            progressData.journalEntries.slice(0, 10).forEach(entry => {
                const card = document.createElement('div');
                card.className = 'entry-card';

                const date = new Date(entry.date);
                card.innerHTML = `
                    <div class="entry-date">${date.toLocaleDateString()} at ${date.toLocaleTimeString()}</div>
                    <div class="entry-text">${entry.text}</div>
                `;

                container.appendChild(card);
            });
        }

        // Chart setup
        let healingChart;

        function updateChart() {
            const ctx = document.getElementById('healingChart').getContext('2d');

            if (healingChart) {
                healingChart.destroy();
            }

            healingChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Emotional Wellbeing', 'Financial Security', 'Social Support', 'Physical Health'],
                    datasets: [{
                        label: 'Healing Progress',
                        data: [
                            progressData.healingMetrics.emotional,
                            progressData.healingMetrics.financial,
                            progressData.healingMetrics.social,
                            progressData.healingMetrics.physical
                        ],
                        backgroundColor: 'rgba(249, 115, 22, 0.2)',
                        borderColor: '#f97316',
                        borderWidth: 2,
                        pointBackgroundColor: '#dc2626',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#dc2626'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Export progress
        function exportProgress() {
            const date = new Date().toLocaleDateString();
            const completed = progressData.completedMilestones.length;
            const phaseNames = ['Recognition', 'Planning', 'Action', 'Healing', 'Independence', 'Flourishing'];

            let completedActions = milestones
                .filter(m => progressData.completedMilestones.includes(m.id))
                .map(m => `- ${m.text}`)
                .join('\n');

            if (!completedActions) {
                completedActions = '- None yet';
            }

            let journalEntry = '';
            if (progressData.journalEntries.length > 0) {
                const latest = progressData.journalEntries[0];
                journalEntry = latest.text;
            } else {
                journalEntry = 'No journal entries yet.';
            }

            const progressReport = `
LIBERATE PROGRESS REPORT
Generated: ${date}

==================================
JOURNEY OVERVIEW
==================================
Start Date: ${new Date(progressData.startDate).toLocaleDateString()}
Days of Freedom: ${calculateDaysSince()}
Current Phase: ${phaseNames[progressData.currentPhase - 1]}
Overall Progress: ${Math.round((completed / 24) * 100)}%

==================================
MILESTONES COMPLETED (${completed}/24)
==================================
${completedActions}

==================================
HEALING METRICS
==================================
Emotional Wellbeing: ${progressData.healingMetrics.emotional}/100
Financial Security: ${progressData.healingMetrics.financial}/100
Social Support: ${progressData.healingMetrics.social}/100
Physical Health: ${progressData.healingMetrics.physical}/100

==================================
RECENT JOURNAL ENTRY
==================================
${journalEntry}

==================================
NEXT STEPS
==================================
- Continue daily self-reflection and journaling
- Work on uncompleted milestones in your current phase
- Maintain your support systems (therapy, friends, community)
- Practice self-care and boundary protection
- Celebrate your progress and resilience

Continue your healing journey with support:
https://chatgpt.com/g/g-685f7ec1cae4819183b514fdeff27b43-discern-bot-relationship-navigation-coach`;

            const blob = new Blob([progressReport], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `LIBERATE_Progress_${date.replace(/\//g, '-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Theme Management
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            document.documentElement.setAttribute('data-theme', newTheme);

            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');

            if (newTheme === 'dark') {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = 'Light Mode';
            } else {
                themeIcon.textContent = 'üåô';
                themeText.textContent = 'Dark Mode';
            }

            localStorage.setItem('theme', newTheme);

            // Redraw chart with new theme
            if (healingChart) {
                updateChart();
            }
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);

            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');

            if (savedTheme === 'dark') {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = 'Light Mode';
            } else {
                themeIcon.textContent = 'üåô';
                themeText.textContent = 'Dark Mode';
            }
        }

        // Chatbot Functions
        function toggleChatWidget() {
            const chatPanel = document.getElementById('agent-panel');
            const chatButton = document.getElementById('floating-chat-button');
            if (chatPanel.classList.contains('active')) {
                chatPanel.classList.remove('active');
                chatButton.classList.remove('hidden');
            } else {
                chatPanel.classList.add('active');
                chatButton.classList.add('hidden');
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();

            if (message) {
                addChatMessage(message, 'user');
                input.value = '';

                setTimeout(() => {
                    addChatMessage('Thank you for reaching out! I can help you track your liberation progress, understand your healing metrics, and support your journey toward independence and flourishing.', 'assistant');
                }, 1000);
            }
        }

        function addChatMessage(content, sender) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;

            const avatar = document.createElement('div');
            avatar.className = `chat-avatar ${sender}`;
            avatar.textContent = sender === 'assistant' ? 'üïäÔ∏è' : 'üë§';

            const bubble = document.createElement('div');
            bubble.className = `chat-bubble ${sender}`;
            bubble.textContent = content;

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(bubble);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme();
            updateUI();

            // Chatbot welcome message
            setTimeout(() => {
                addChatMessage('Welcome to your LIBERATE Progress Tracker! I\'m here to support your journey toward freedom, healing, and flourishing. You can ask me about tracking milestones, understanding your progress, or how to navigate each phase of liberation.', 'assistant');
            }, 500);

            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendChatMessage();
                    }
                });
            }
        });
    </script>

    <!-- Floating Chat Button -->
    <button id="floating-chat-button" class="floating-chat-button" onclick="toggleChatWidget()" aria-label="Open chat">
        üïäÔ∏è
    </button>

    <!-- Chat Panel -->
    <div id="agent-panel" class="chat-widget-panel">
        <div class="chat-widget-header">
            <div class="chat-header-title">
                <span class="chat-icon">üïäÔ∏è</span>
                <span>LIBERATE Guide</span>
            </div>
            <div class="chat-header-actions">
                <button class="chat-action-btn" onclick="toggleChatWidget()" aria-label="Close">
                    ‚úï
                </button>
            </div>
        </div>
        <div class="chat-widget-body">
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input-area">
                <textarea id="chat-input" class="chat-input"
                       placeholder="Ask about your progress, phases, or next steps..."
                       aria-label="Chat input"></textarea>
                <button class="send-button" onclick="sendChatMessage()" aria-label="Send message">
                    ‚û§
                </button>
            </div>
        </div>
    </div>
</body>
</html>
